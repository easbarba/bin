#!/usr/bin/env bash

# Debug Options
set -euo pipefail

DEPS=(apt-get)
s-checkdeps "${DEPS[@]}"

INSTALL='sudo apt-get install -y'

lisp=(guile-3.0 guile-*-doc libzstd-dev)
go=(golang golang-golang-x-tools)
pg=(postgresql postgresql-client postgresql-contrib libpq-dev)
langs=(ruby-full)
langs_tools=(python3-pip)
mx=(emacs libgccjit0 libgccjit-12-dev libwebkit2gtk-4.0-dev libjansson-dev libjansson4)
tools=(jq git-email subversion mercurial libpq-dev editorconfig direnv fd-find shfmt meson cmake)
editors=(zile vim neovim tidy ripgrep)

groups=("${mx[@]}"
    "${go[@]}"
    "${langs[@]}"
    "${js[@]}"
    "${lisp[@]}"
    "${langs_tools[@]}"
    "${editors[@]}"
    "${pg[@]}"
    "${tools[@]}")

for group in "${groups[@]}"; do
    s-dolist "$INSTALL" "$group"
done

if [[ ! $(command -v dart) ]]; then
    sudo apt-get update
    sudo apt-get install -y apt-transport-https
    wget -qO- https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo gpg --dearmor -o /usr/share/keyrings/dart.gpg
    echo 'deb [signed-by=/usr/share/keyrings/dart.gpg arch=amd64] https://storage.googleapis.com/download.dartlang.org/linux/debian stable main' | sudo tee /etc/apt/sources.list.d/dart_stable.list

    sudo apt-get update
    sudo apt-get install -y dart
fi

if [[ ! $(command -v dbeaver) ]]; then
    [[ ! -f /tmp/dbeaver-ce_latest_amd64.deb ]] && wget -c "https://dbeaver.io/files/dbeaver-ce_latest_amd64.deb" -P /tmp
    sudo apt install -y /tmp/dbeaver-ce_latest_amd64.deb
fi

exit
